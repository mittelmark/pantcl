
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Security-Policy" content="default-src 'self' data: ; script-src 'self' 'nonce-d717cfb5d902616b7024920ae20346a8494f7832145c90e0' ; style-src 'self' 'unsafe-inline'" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="title" content="pantcl filter documentation - 0.9.9">
<meta name="author" content="Detlef Groth, Schwielowsee, Germany">
<title>pantcl filter documentation - 0.9.9</title>
<link rel='stylesheet' href='mini.css' type='text/css'>
</head>
<body>

<h1 class="title">pantcl filter documentation - 0.9.9</h1>
<h2 class="author">Detlef Groth, Schwielowsee, Germany</h2>
<h2 class="date">2023-03-08</h2>
<hr/>

<p><center></p>

<p>Filters: 
<a href="lib/tclfilters/filter-abc.html">filter-abc</a> -
<a href="lib/tclfilters/filter-cmd.html">filter-cmd</a> -
<a href="lib/tclfilters/filter-dot.html">filter-dot</a> -
<a href="lib/tclfilters/filter-eqn.html">filter-eqn</a> -
<a href="lib/tclfilters/filter-mmd.html">filter-mmd</a> -
<a href="lib/tclfilters/filter-mtex.html">filter-mtex</a> -
<a href="lib/tclfilters/filter-pic.html">filter-pic</a> -
<a href="lib/tclfilters/filter-pik.html">filter-pik</a> -
<a href="lib/tclfilters/filter-pipe.html">filter-pipe</a> -
<a href="lib/tclfilters/filter-puml.html">filter-puml</a> -
<a href="lib/tclfilters/filter-rplot.html">filter-rplot</a> - 
<a href="lib/tclfilters/filter-sqlite.html">filter-sqlite</a> -
<a href="lib/tclfilters/filter-tcrd.html">filter-tcrd</a> -
<a href="lib/tclfilters/filter-tcl.html">filter-tcl</a> -
<a href="lib/tclfilters/filter-tdot.html">filter-tdot</a> -
<a href="lib/tclfilters/filter-tsvg.html">filter-tsvg</a> <br /></p>

<p>Documentation: 
<a href="pantcl.html">Pantcl documentation</a> - 
<a href="pantcl-tutorial.html">Pantcl Tutorial</a> -
<a href="README.html">Pantcl Readme</a> -
<a href="lib/fview/filter-view.html">Pantcl GUI filter viewer</a> 
</center></p>

<hr/>

<h2>NAME</h2>

<p><em>pantcl.tcl</em> - filter application for the pandoc command line 
application to convert Markdown files into other formats. The filter allows you to embed Tcl code into your Markdown
documentation and offers a plugin architecture to add other command line filters easily using Tcl
and the <code>exec</code> command. As examples are given in the filter folder of the project:</p>

<ul>
<li>Tcl filter {.tcl}: <code>filter-tcl.tcl</code> <a href="filter/filter-tcl.html">filter/filter-tcl.html</a></li>
<li>ABC music filter {.abc}: <code>filter-abc.tcl</code> <a href="filter/filter-abc.html">filter/filter-abc.html</a></li>
<li>command line application filter {.cmd}: <code>filter-cmd.tcl</code> <a href="filter/filter-cmd.html">filter/filter-abc.html</a></li>
<li>Graphviz dot filter {.dot}: <code>filter-dot.tcl</code> <a href="filter/filter-dot.html">filter/filter-dot.html</a></li>
<li>EQN filter plugin for equations written in the EQN language {.eqn}: <code>filter-eqn</code> <a href="filter/filter-eqn.html">filter/filter-eqn.html</a></li>
<li>Math TeX filter for single line equations {.mtex}: <code>filter-mtex.tcl</code> <a href="filter/filter-mtex.html">filter/filter-mtex.html</a></li>
<li>Mermaid filter for diagrams {.mmd}: <code>filter-mmd.tcl</code> <a href="filter/filter-mmd.html">filter/filter-mmd.html</a></li>
<li>Pikchr filter plugin for diagram creation {.pikchr}: <code>filter-pik.tcl</code> <a href="filter/filter-pik.html">filter/filter-pik.html</a></li>
<li>PIC filter plugin for diagram creation (older version) {.pic}: <code>filter-pic.tcl</code> <a href="filter/filter-pic.html">filter/filter-pic.html</a></li>
<li>pipe filter for R, Python and Octave {.pipe}: <code>filter-pipe.tcl</code> <a href="filter/filter-pipe.html">filter/filter-pipe.html</a></li>
<li>PlantUMLfilter plugin for diagram creation {.puml}: <code>filter-puml.tcl</code> <a href="filter/filter-puml.html">filter/filter-puml.html</a></li>
<li>R plot filter plugin for displaying plots in the R statistical language {.rplot}: <code>filter-rplot.tcl</code> <a href="filter/filter-rplot.html">filter/filter-rplot.html</a></li>
<li>sqlite3 filter plugin to evaluate SQL code {.sqlite}: <code>filter-sqlite.tcl</code> <a href="filter/filter-sqlite.html">filter/filter-sqlite.html</a></li>
<li>tcrd filter for music songs with chords {.tcrd}: <code>filter-tcrd.tcl</code> <a href="filter/filter-tcrd.html">filter/filter-tcrd.html</a></li>
<li>tdot package filter {.tsvg}: <code>filter-tdot.tcl</code> <a href="filter/filter-tdot.html">filter/filter-tdot.html</a></li>
<li>tsvg package filter {.tsvg}: <code>filter-tsvg.tcl</code> <a href="filter/filter-tsvg.html">filter/filter-tsvg.html</a>
</li></ul>

<h2>SYNOPSIS </h2>

<pre class='code'><code># standalone application
pantcl.tapp infile outfile ?options?
# as filter
pandoc infile --filter pantcl.tapp ?options?
# as graphics user interface
pantcl.tapp --gui</code></pre>

<p>Where options for the filter and the standalone mode
are the usual pandoc options. For HTML conversion you should use for instance:</p>

<pre class='code'><code>pantcl.tapp infile.md outfile.html --css style.css -s --toc</code></pre>

<p>Please note, that you can rename as well the file <code>pantcl.tapp</code> into just <code>pantcl</code> to use it like a normal standalone application without file extension.</p>

<h2>Code embedding
Embed code either inline or in form of code chunks like here (triple ticks):</h2>

<pre class='code'><code>    ```{.tcl}
    set x 4
    incr x
    set x
    ```
  
    Hello this is Tcl `tcl package provide Tcl`!</code></pre>

<h2>Filter Overview </h2>

<p>The markers for the other filters are:</p>

<p><code>{.abc},</code>{.dot}<code>,</code>{.eqn}<code>,</code>{.mmd}<code>,</code>{.mtex}<code>,</code>{.pic}<code>,</code>{.pikchr}, <code>{.puml}</code>, <code>{.rplot}</code>,<code>{.sqlite}</code> and <code>{.tsvg}</code>.</p>

<p>For details on how to use them have a look at the manual page links on top.</p>

<p>You can combine all filters in one document  just by using the appropiate markers.</p>

<p>Here an overview about the required tools to use a filter:</p>

<p><center></p>

<table class="table">
<thead>
  <tr>
    <th>filter</th>
    <th>tool</th>
    <th>svg</th>
    <th>png</th>
    <th>pdf</th>
    <th>comment</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>.tcl</td>
    <td>tclsh</td>
    <td>tsvg</td>
    <td>cairosvg</td>
    <td>cairosvg</td>
    <td>programming</td>
  </tr>
  <tr>
    <td>.abc</td>
    <td>abcm2ps</td>
    <td>abcm2ps</td>
    <td>cairosvg</td>
    <td>cairosvg</td>
    <td>music</td>
  </tr>
  <tr>
    <td>.dot</td>
    <td>dot</td>
    <td>native</td>
    <td>native</td>
    <td>native</td>
    <td>diagrams</td>
  </tr>
  <tr>
    <td>.eqn</td>
    <td>eqn2graph</td>
    <td>no</td>
    <td>convert</td>
    <td>no</td>
    <td>math</td>
  </tr>
  <tr>
    <td>.mmd</td>
    <td>mermaid-cli (mmdc)</td>
    <td>native</td>
    <td>native</td>
    <td>native</td>
    <td>diagrams</td>
  </tr>
  <tr>
    <td>.mtex</td>
    <td>latex</td>
    <td>dvisgm</td>
    <td>dvipng</td>
    <td>dvipdfm</td>
    <td>math, diagrams, games</td>
  </tr>
  <tr>
    <td>.pic</td>
    <td>pic2graph</td>
    <td>no</td>
    <td>convert</td>
    <td>no</td>
    <td>diagrams</td>
  </tr>
  <tr>
    <td>.pik</td>
    <td>fossil</td>
    <td>native</td>
    <td>cairosvg</td>
    <td>cairosvg</td>
    <td>diagrams</td>
  </tr>
  <tr>
    <td>.pipe</td>
    <td>R / python / octave</td>
    <td>native</td>
    <td>native</td>
    <td>native</td>
    <td>Statistics, Programming</td>
  </tr>
  <tr>
    <td>.puml</td>
    <td>plantuml</td>
    <td>native</td>
    <td>native</td>
    <td>native</td>
    <td>diagrams</td>
  </tr>
  <tr>
    <td>.rplot</td>
    <td>R</td>
    <td>native</td>
    <td>native</td>
    <td>native</td>
    <td>statistics, graphics</td>
  </tr>
  <tr>
    <td>.tcrd</td>
    <td>tclsh</td>
    <td>no</td>
    <td>no</td>
    <td>no</td>
    <td>music, songs with chords</td>
  </tr>
  <tr>
    <td>.tdot</td>
    <td>tclsh/dot</td>
    <td>native</td>
    <td>native</td>
    <td>native</td>
    <td>diagrams</td>
  </tr>
  <tr>
    <td>.tsvg</td>
    <td>tclsh</td>
    <td>native</td>
    <td>cairosvg</td>
    <td>cairosvg</td>
    <td>graphics</td>
  </tr>
</tbody>
</table>


<p></center></p>

<p>The Markdown document within this file could be extracted and converted as follows:</p>

<pre class='code'><code> pantcl pantcl.tcl pantcl.html \
   --css mini.css -s</code></pre>

<h2>Example Tcl Filter</h2>

<h4>Tcl-filter</h4>

<pre class='code'><code>    ```{.tcl}
    set x 1
    puts $x
    ```</code></pre>

<p>And here the output:</p>

<pre class='code'><code class='tclinn'>set x 1
puts $x
</code></pre>

<pre class='code'><code class='tclout'>1</code></pre>

<p>Does indented code blocks works as well?</p>

<blockquote>
<pre class='code'><code class='tclinn'>  set x 2
  puts $x
</code></pre>

<pre class='code'><code class='tclout'>2</code></pre>

<p>Yes, since version 0.7.0!!</p>
</blockquote>

<p>There is as well the possibility to inline Tcl code like here:</p>

<pre class='code'><code>This document was processed using Tcl `tcl set tcl_patchLevel`!</code></pre>

<p>will produce:</p>

<p>This document was processed using Tcl !</p>

<p>This works as well in nested structures like lists or quotes.</p>

<blockquote>
<p>This document was processed using Tcl !</p>

<ul>
<li>This document was processed using Tcl !</li></ul>


</blockquote>

<h2>Filter - Plugins</h2>

<p>The pantcl.tcl application allows to create custom filters for other 
command line application quite easily. The Tcl files has to be named <code>filter-NAME.tcl</code>
where NAME hast to match the code chunk marker. Below an example:</p>

<pre class='code'><code>   ` ``{.dot label=dotgraph}
   digraph G {
     main -&gt; parse -&gt; execute;
     main -&gt; init;
     main -&gt; cleanup;
     execute -&gt; make_string;
     execute -&gt; printf
     init -&gt; make_string;
     main -&gt; printf;
     execute -&gt; compare;
   }

   &lt;image src=&quot;dotgraph.svg&quot;&gt;&lt;/img&gt;
   ` ``</code></pre>

<p>The main script <code>pantcl.tcl</code> evaluates if in the same folder as the script is,
if there any other files named <code>filter/filter-NAME.tcl</code> and sources them. In case of the dot
filter the file is named <code>filter-dot.tcl</code> and its filter function <code>filter-dot</code> is 
executed. Below is the simplified code: of this file <code>filter-dot.tcl</code>:</p>

<pre class='code'><code class='tclinn'># a simple pandoc filter using Tcl
# the script pantcl.tcl 
# must be in the same filter directoy of the pantcl.tcl file
proc filter-dot {cont dict} {
    global n
    incr n
    set def [dict create app dot results show eval true fig true 
             label null ext svg width 400 height 400 \
             include true imagepath images]
    # fuse code chunk options with defaults
    set dict [dict merge $def $dict]
    set ret &quot;&quot;
    if {[dict get $dict label] eq &quot;null&quot;} {
        set fname dot-$n
    } else {
        set fname [dict get $dict label]
    }
    # save dot file
    set out [open $fname.dot w 0600]
    puts $out $cont
    close $out
    # TODO: error catching
    set res [exec [dict get $dict app] -Tsvg $fname.dot -o $fname.svg]
    if {[dict get $dict results] eq &quot;show&quot;} {
        # should be usually empty
        set res $res
    } else {
        set res &quot;&quot;
    }
    set img &quot;&quot;
    if {[dict get $dict fig]} {
        if {[dict get $dict include]} {
            set img $fname.svg
        }
    }
    return [list $res $img]
}
</code></pre>

<p>Using the label and the option <code>include=false</code> we could create an image link manually using Markdown syntax. The 
The image filename should be then images/label.svg for instance.</p>

<h2>Dot Example</h2>

<p>Here a longer dot-example where the code is include in</p>

<pre class='code'><code class='dotinn'>digraph G {
  margin=0.1;
  node[fontname=&quot;Linux Libertine&quot;;fontsize=18];
  node[shape=box,style=filled;fillcolor=skyblue,width=1.2,height=0.9];    
  { rank=same; Rst[group=g0,fillcolor=salmon] ; 
    Docx [group=g1,fillcolor=salmon]
  }
  { rank=same; Md[group=g0,fillcolor=salmon]  ; 
    pandoc ; AST1 ; filter[fillcolor=cornsilk] ; AST2 ; pandoc2;  
    Html[group=g1,fillcolor=salmon] 
  }
  { rank=same; Tex[group=g0,fillcolor=salmon] ; 
    Pdf[group=g1,fillcolor=salmon]; filters[fillcolor=cornsilk]; 
  }
  node[fillcolor=cornsilk]; 
  { rank=same; dot ; eqn; mtex; pic; pik; rplot; tsvg;}
  Rst -&gt; pandoc -&gt; AST1 -&gt; filter -&gt; AST2 -&gt; pandoc2 -&gt; Html ;
  Md -&gt; pandoc;
  Tex -&gt; pandoc;
  Rst -&gt; Md -&gt; Tex -&gt; dot[style=invis] ;
  pandoc2 -&gt; Docx;
  pandoc2 -&gt; Pdf ;
  Docx -&gt; Html -&gt; Pdf -&gt; tsvg[style=invis];
  pandoc2[label=pandoc];
  filter[label=&quot;pantcl\nfilter&quot;];
  filter-&gt;filters;
  filters -&gt; dot ;
  filters -&gt; eqn ;
  filters -&gt; mtex;
  filters -&gt; pic ;
  filters -&gt; pik ; 
  filters -&gt; rplot;
  filters -&gt; tsvg; 
}
</code></pre>

<p><image src="/home/groth/workspace/pantcl/images/dot-1.svg"></img></p>

<h2>Creating Markdown Code</h2>

<p>Since version 0.5.0 it is as well possible to create Markup code within code blocks and to return it. 
To achieve this you to set use code chunk option results like this: <code>results=&quot;asis&quot;</code> -
which should be usually used together with <code>echo=false</code>. Here an example:</p>

<pre class='code'><code>     ```{.tcl echo=false results=&quot;asis&quot;}
     return &quot;**this is bold** and _this is italic_ text!&quot;
     ```    </code></pre>

<p>which gives this output:</p>

<p><strong>this is bold</strong> and <em>this is italic</em> text!</p>

<p>This can be as well used to include other Markup files. Here an example:</p>

<pre class='code'><code>    ```{.tcl results=&quot;asis&quot;}
    include tests/inc.md
    ```</code></pre>

<p>And here is the result:</p>

<pre class='code'><code class='tclinn'>include tests/inc.md
</code></pre>

<p>I am test.md and here some text is written in <strong>bold</strong>.</p>

<p>Please note, that currently no filters are applied on the included files. 
You should process them before using the pandoc filters and choose output format Markdown to include them later
in your master document.</p>

<p>To just show some file content as it is, remove the results=&quot;asis&quot;, 
this can be as well useful to display some source code, let's here simply show here the content of <em>tests/inc.md</em> without interpreting it as Markdown in a source code block:</p>

<pre class='code'><code>    ```{.tcl results=&quot;show&quot;}
    include tests/inc.md
    ```</code></pre>

<p>And here is the result:</p>

<pre class='code'><code class='tclinn'>include tests/inc.md
</code></pre>

<pre class='code'><code class='tclout'>I am test.md and here some text is written in **bold**.</code></pre>

<h2>Documentation</h2>

<p>To use this pipeline and to create pantcl.html out of the code documentation 
in pantcl.tapp your command in the terminal is still just:</p>

<pre class='code'><code>pantcl.tapp pantcl.tcl pantcl.html -s --css mini.css</code></pre>

<p>The result should be the file which you are looking currently.</p>

<h2>ChangeLog</h2>

<ul>
<li>2021-08-22 Version 0.1</li>
<li>2021-08-28 Version 0.2
<ul>
<li>adding custom filters structure (dot, tsvg examples)</li>
<li>adding attributes label, width, height, results</li></ul>

</li>
<li>2021-08-31 Version 0.3
<ul>
<li>moved filters into filter folder</li>
<li>plugin example mtex</li>
<li>default image path <em>images</em></li></ul>

</li>
<li>2021-11-03 Version 0.3.1
<ul>
<li>fix for parray and &quot;puts stdout&quot;</li></ul>

</li>
<li>2021-11-15 Version 0.3.2
<ul>
<li>--help argument support</li>
<li>--version argument support</li>
<li>filters for Pikchr, PIC and EQN</li></ul>

</li>
<li>2021-11-30 Version 0.3.3
<ul>
<li>filter for R plots: <code>.rplot</code></li></ul>

</li>
<li>2021-12-04 Version 0.4.0
<ul>
<li>pandoc-tcl-filter can be as well directly used for conversion 
  being then a frontend which calls pandoc internally with 
  itself as a filter ...</li></ul>

</li>
<li>2021-12-12 Version 0.5.0</li>
<li>support for Markdown code creation in the Tcl filter with results=&quot;asis&quot;</li>
<li>adding list2mdtab proc to the Tcl filter</li>
<li>adding include proc to the Tcl filter with results='asis' other Markdown files can be included.</li>
<li>support for <code>pandoc-tcl-filter.tcl infile --tangle .tcl</code>  to extract code chunks to the terminal</li>
<li>support for Mermaid diagrams</li>
<li>support for PlantUML diagrams </li>
<li>support for ABC music notation</li>
<li>bug fix for Tcl filters for <code>eval=false</code></li>
<li>documentation improvements for the filters and for the pandoc-tcl-filter</li>
<li>2022-01-09 - version 0.6.0</li>
<li>adding filter-cmd.tcl for shell scripts for all type of programming languages and tools</li>
<li>filter-mtex.tcl with more examples for different LaTeX packages like tikz, pgfplot, skak, sudoku, etc.</li>
<li>adding filter-tdot.tcl for tdot Tcl package</li>
<li>adding filter-tcrd.tcl for writing music chords above song lyrics</li>
<li>2022-02-05 - version 0.7.0</li>
<li>graphical user interface to the graphical filters (abc, dot, eqn, mmd, mtex, pic, pikchr, puml, rplot, tdot, tsvg) using the command line option <em>--gui</em></li>
<li>can now as well work without pandoc standalone for conversion of Markdown with code chunks into 
 Markdown with evaluated code chunks and HTML code using the
 Markdown library of tcllib</li>
<li>that way it deprecates the use of tmdoc::tmdoc and mkdoc::mkdoc as it contains now the same functionality</li>
<li>support for inline code evaluations for Tcl, Python (pipe filter) and R (pipe filter) statements as well in nested paragraphs, lists and headers</li>
<li>support for indented code blocks with evaluation</li>
<li>new - filter-pipe:
<ul>
<li>initial support for R code block features and inline evaluation and error catching</li>
<li>initial support for Python with code block features and inline evaluation and error catching</li>
<li>initial support for Octave with code block features and error checking</li></ul>

</li>
<li>more examples filter-mtex, filter-puml, filter-pikchr </li>
<li>fix for filter-tcl making variables chunk and res namespace variables, avoiding variable collisions</li>
<li>2023-01-10 - version 0.9.0</li>
<li>renamed to pantcl.tcl and creating it's own repository</li>
<li>2023-03-05 - fixing a problem with the @symbol in text
<br/></li></ul>

<h2>SEE ALSO</h2>

<ul>
<li><a href="Readme.html">Readme.html</a> - more information and small tutorial</li>
<li><a href="examples/example-eqn.html">Examples</a> - more examples for the filters </li>
<li><a href="https://wiki.tcl-lang.org/page/pandoc%2Dtcl%2Dfilter">Tclers Wiki page</a> - place for discussion</li>
<li><a href="https://pandoc.org/filters.html">Pandoc filter documentation</a> - more background and information on how to implement filters in Haskell and Markdown</li>
<li><a href="https://github.com/pandoc/lua-filters">Lua filters on GitHub</a></li>
<li><a href="https://github.com/LaurentRDC/pandoc-plot">Plotting filters on Github</a></li>
<li><a href="https://github.com/topics/pandoc-filter">Github Pandoc filter list</a>
</li></ul>

<h2>AUTHOR</h2>

<p>Dr. Detlef Groth, Caputh-Schwielowsee, Germany, detlef(<em>at</em>)dgroth(<em>dot</em>).de</p>

<h2>LICENSE</h2>

<p><em>MIT License</em></p>

<p>Copyright (c) 2021-2022 Dr. Detlef Groth, Caputh-Schwielowsee, Germany</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</p>

</body>
</html>
